<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LocalBP åˆ†æ”¯é¢„æµ‹å™¨åŠ¨ç”»æ¼”ç¤º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Consolas', 'Monaco', monospace;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
            color: #eee;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: #00d4ff;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 30px;
        }

        /* ä»£ç åŒºåŸŸ */
        .code-section {
            background: #0d1117;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #30363d;
        }

        .code-section h3 {
            color: #58a6ff;
            margin-bottom: 15px;
        }

        .code-line {
            padding: 5px 10px;
            border-radius: 4px;
            transition: all 0.3s;
        }

        .code-line.highlight {
            background: #388bfd33;
            border-left: 3px solid #58a6ff;
        }

        .code-line .line-num {
            color: #6e7681;
            margin-right: 15px;
            user-select: none;
        }

        .code-line .keyword {
            color: #ff7b72;
        }

        .code-line .type {
            color: #79c0ff;
        }

        .code-line .number {
            color: #a5d6ff;
        }

        .code-line .comment {
            color: #8b949e;
        }

        .code-line .var {
            color: #ffa657;
        }

        /* ä¸»è¦å±•ç¤ºåŒº */
        .main-display {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        /* PC å’Œç´¢å¼•è®¡ç®— */
        .calc-section {
            background: #0d1117;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #30363d;
        }

        .calc-section h3 {
            color: #58a6ff;
            margin-bottom: 15px;
        }

        .calc-row {
            display: flex;
            align-items: center;
            margin: 10px 0;
            font-size: 16px;
        }

        .calc-label {
            width: 120px;
            color: #8b949e;
        }

        .calc-value {
            background: #21262d;
            padding: 8px 15px;
            border-radius: 5px;
            font-family: monospace;
            color: #7ee787;
            min-width: 150px;
        }

        .calc-arrow {
            color: #f0883e;
            margin: 0 10px;
            font-size: 20px;
        }

        /* è®¡æ•°å™¨è¡¨ */
        .counter-table {
            background: #0d1117;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #30363d;
        }

        .counter-table h3 {
            color: #58a6ff;
            margin-bottom: 15px;
        }

        .table-container {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .counter-cell {
            width: 50px;
            height: 50px;
            background: #21262d;
            border-radius: 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .counter-cell.active {
            border-color: #f0883e;
            background: #f0883e22;
            transform: scale(1.1);
            box-shadow: 0 0 20px #f0883e55;
        }

        .counter-cell .idx {
            font-size: 10px;
            color: #6e7681;
        }

        .counter-cell .val {
            font-size: 18px;
            font-weight: bold;
            color: #7ee787;
        }

        /* çŠ¶æ€æœº */
        .state-machine {
            background: #0d1117;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #30363d;
        }

        .state-machine h3 {
            color: #58a6ff;
            margin-bottom: 15px;
        }

        .states {
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 20px 0;
        }

        .state {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            border: 3px solid #30363d;
            background: #21262d;
        }

        .state.not-taken {
            border-color: #f85149;
        }

        .state.taken {
            border-color: #3fb950;
        }

        .state.active {
            transform: scale(1.2);
            box-shadow: 0 0 30px currentColor;
        }

        .state.active.not-taken {
            background: #f8514933;
        }

        .state.active.taken {
            background: #3fb95033;
        }

        .state .state-val {
            font-size: 20px;
            font-weight: bold;
        }

        .state .state-name {
            font-size: 10px;
            margin-top: 5px;
        }

        .state-arrow {
            color: #6e7681;
            font-size: 24px;
        }

        /* é¢„æµ‹ç»“æœ */
        .result-section {
            background: #0d1117;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #30363d;
        }

        .result-section h3 {
            color: #58a6ff;
            margin-bottom: 15px;
        }

        .result-row {
            display: flex;
            gap: 30px;
            margin: 15px 0;
        }

        .result-item {
            flex: 1;
            background: #21262d;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .result-item .label {
            color: #8b949e;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .result-item .value {
            font-size: 24px;
            font-weight: bold;
        }

        .result-item .value.taken {
            color: #3fb950;
        }

        .result-item .value.not-taken {
            color: #f85149;
        }

        .result-item .value.correct {
            color: #3fb950;
        }

        .result-item .value.wrong {
            color: #f85149;
        }

        /* å†å²è®°å½• */
        .history-section {
            background: #0d1117;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #30363d;
        }

        .history-section h3 {
            color: #58a6ff;
            margin-bottom: 15px;
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
        }

        .history-table th,
        .history-table td {
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid #30363d;
        }

        .history-table th {
            color: #8b949e;
            font-weight: normal;
        }

        .history-table .correct {
            color: #3fb950;
        }

        .history-table .wrong {
            color: #f85149;
        }

        /* æ§åˆ¶æŒ‰é’® */
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
        }

        .btn-primary {
            background: #238636;
            color: white;
        }

        .btn-primary:hover {
            background: #2ea043;
        }

        .btn-secondary {
            background: #21262d;
            color: #c9d1d9;
            border: 1px solid #30363d;
        }

        .btn-secondary:hover {
            background: #30363d;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ç»Ÿè®¡ */
        .stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-item .stat-value {
            font-size: 36px;
            font-weight: bold;
            color: #58a6ff;
        }

        .stat-item .stat-label {
            color: #8b949e;
            font-size: 14px;
        }

        /* è¯´æ˜æ–‡å­— */
        .explanation {
            background: #161b22;
            border-left: 4px solid #58a6ff;
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }

        .explanation p {
            margin: 5px 0;
            line-height: 1.6;
        }

        .explanation .highlight-text {
            color: #f0883e;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ”® LocalBP åˆ†æ”¯é¢„æµ‹å™¨åŠ¨ç”»æ¼”ç¤º</h1>
        <p class="subtitle">gem5 ä¸­æœ€ç®€å•çš„åˆ†æ”¯é¢„æµ‹å™¨ - 2-bit é¥±å’Œè®¡æ•°å™¨</p>

        <!-- æ§åˆ¶æŒ‰é’® -->
        <div class="controls">
            <button class="btn btn-primary" id="nextBtn" onclick="nextStep()">â–¶ ä¸‹ä¸€æ­¥</button>
            <button class="btn btn-secondary" id="autoBtn" onclick="toggleAuto()">â© è‡ªåŠ¨æ’­æ”¾</button>
            <button class="btn btn-secondary" onclick="reset()">ğŸ”„ é‡ç½®</button>
        </div>

        <!-- ä»£ç åŒºåŸŸ -->
        <div class="code-section">
            <h3>ğŸ“ æ±‡ç¼–ä»£ç  (x86-64)</h3>
            <div class="code-line" id="code-0">
                <span class="line-num">0x401000:</span>
                <span class="keyword">xor</span> <span class="var">eax</span>, <span class="var">eax</span> <span
                    class="comment">; sum = 0</span>
            </div>
            <div class="code-line" id="code-1">
                <span class="line-num">0x401002:</span>
                <span class="keyword">xor</span> <span class="var">ecx</span>, <span class="var">ecx</span> <span
                    class="comment">; i = 0</span>
            </div>
            <div class="code-line" id="code-2">
                <span class="line-num">0x401004:</span>
                <span class="type">loop:</span>
            </div>
            <div class="code-line" id="code-3">
                <span class="line-num">0x401004:</span>
                <span class="keyword">add</span> <span class="var">eax</span>, <span class="var">ecx</span> <span
                    class="comment">; sum += i</span>
            </div>
            <div class="code-line" id="code-4">
                <span class="line-num">0x401006:</span>
                <span class="keyword">inc</span> <span class="var">ecx</span> <span class="comment">; i++</span>
            </div>
            <div class="code-line" id="code-5">
                <span class="line-num">0x401008:</span>
                <span class="keyword">cmp</span> <span class="var">ecx</span>, <span class="number">4</span> <span
                    class="comment">; compare i with 4</span>
            </div>
            <div class="code-line" id="code-6">
                <span class="line-num">0x40100B:</span>
                <span class="keyword">jl</span> <span class="var">loop</span> <span class="comment">; if (i &lt; 4) goto
                    loop â† åˆ†æ”¯æŒ‡ä»¤!</span>
            </div>
            <div class="code-line" id="code-7">
                <span class="line-num">0x40100D:</span>
                <span class="keyword">ret</span> <span class="comment">; return</span>
            </div>
        </div>

        <!-- è¯´æ˜ -->
        <div class="explanation" id="explanation">
            <p>ğŸ‘‹ æ¬¢è¿ï¼è¿™ä¸ªåŠ¨ç”»æ¼”ç¤º LocalBP å¦‚ä½•é¢„æµ‹ä¸€ä¸ªç®€å•å¾ªç¯çš„åˆ†æ”¯ã€‚</p>
            <p>å¾ªç¯æ‰§è¡Œ 4 æ¬¡ (i=0,1,2,3)ï¼Œå‰ 4 æ¬¡åˆ†æ”¯è·³è½¬ (Taken)ï¼Œæœ€å 1 æ¬¡ä¸è·³è½¬ (Not Taken) é€€å‡ºå¾ªç¯ã€‚</p>
            <p>è®¡æ•°å™¨åˆå§‹å€¼ä¸º <span class="highlight-text">0 (00)</span>ï¼Œå³"å¼ºä¸è·³è½¬"çŠ¶æ€ã€‚</p>
            <p>ç‚¹å‡» <span class="highlight-text">"ä¸‹ä¸€æ­¥"</span> å¼€å§‹æ¼”ç¤ºï¼</p>
        </div>

        <!-- ä¸»è¦å±•ç¤ºåŒº -->
        <div class="main-display">
            <!-- PC å’Œç´¢å¼•è®¡ç®— -->
            <div class="calc-section">
                <h3>ğŸ”¢ ç´¢å¼•è®¡ç®— (jl æŒ‡ä»¤)</h3>
                <div class="calc-row">
                    <span class="calc-label">PC åœ°å€:</span>
                    <span class="calc-value" id="pc-value">0x40100B</span>
                </div>
                <div class="calc-row">
                    <span class="calc-label">å³ç§» 2 ä½:</span>
                    <span class="calc-value" id="shift-value">0x100402</span>
                </div>
                <div class="calc-row">
                    <span class="calc-label">& 0x3FF:</span>
                    <span class="calc-value" id="index-value">2</span>
                </div>
                <div class="calc-row" style="margin-top: 20px;">
                    <span class="calc-label">å½“å‰ i =</span>
                    <span class="calc-value" id="i-value">-</span>
                </div>
            </div>

            <!-- è®¡æ•°å™¨è¡¨ -->
            <div class="counter-table">
                <h3>ğŸ“Š è®¡æ•°å™¨è¡¨ localCtrs[]</h3>
                <div class="table-container" id="counter-table">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>

        <!-- çŠ¶æ€æœº -->
        <div class="state-machine">
            <h3>ğŸ”„ 2-bit é¥±å’Œè®¡æ•°å™¨çŠ¶æ€æœº</h3>
            <div class="states">
                <div class="state not-taken" id="state-0">
                    <span class="state-val">00</span>
                    <span class="state-name">å¼ºä¸è·³</span>
                </div>
                <span class="state-arrow">âŸ·</span>
                <div class="state not-taken" id="state-1">
                    <span class="state-val">01</span>
                    <span class="state-name">å¼±ä¸è·³</span>
                </div>
                <span class="state-arrow">âŸ·</span>
                <div class="state taken" id="state-2">
                    <span class="state-val">10</span>
                    <span class="state-name">å¼±è·³è½¬</span>
                </div>
                <span class="state-arrow">âŸ·</span>
                <div class="state taken" id="state-3">
                    <span class="state-val">11</span>
                    <span class="state-name">å¼ºè·³è½¬</span>
                </div>
            </div>
            <p style="text-align: center; color: #8b949e; margin-top: 10px;">
                â† Not Taken (å‡1) &nbsp;&nbsp;&nbsp;&nbsp; Taken (åŠ 1) â†’
            </p>
        </div>

        <!-- é¢„æµ‹ç»“æœ -->
        <div class="result-section">
            <h3>ğŸ“‹ å½“å‰é¢„æµ‹</h3>
            <div class="result-row">
                <div class="result-item">
                    <div class="label">è®¡æ•°å™¨å€¼</div>
                    <div class="value" id="counter-display">-</div>
                </div>
                <div class="result-item">
                    <div class="label">é¢„æµ‹ç»“æœ</div>
                    <div class="value" id="prediction-display">-</div>
                </div>
                <div class="result-item">
                    <div class="label">å®é™…ç»“æœ</div>
                    <div class="value" id="actual-display">-</div>
                </div>
                <div class="result-item">
                    <div class="label">é¢„æµ‹æ­£ç¡®?</div>
                    <div class="value" id="correct-display">-</div>
                </div>
            </div>
        </div>

        <!-- å†å²è®°å½• -->
        <div class="history-section">
            <h3>ğŸ“œ é¢„æµ‹å†å²</h3>
            <table class="history-table">
                <thead>
                    <tr>
                        <th>å¾ªç¯æ¬¡æ•°</th>
                        <th>i å€¼</th>
                        <th>è®¡æ•°å™¨(å‰)</th>
                        <th>é¢„æµ‹</th>
                        <th>å®é™…</th>
                        <th>ç»“æœ</th>
                        <th>è®¡æ•°å™¨(å)</th>
                    </tr>
                </thead>
                <tbody id="history-body">
                </tbody>
            </table>
        </div>

        <!-- ç»Ÿè®¡ -->
        <div class="stats">
            <div class="stat-item">
                <div class="stat-value" id="total-count">0</div>
                <div class="stat-label">æ€»é¢„æµ‹æ¬¡æ•°</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="correct-count">0</div>
                <div class="stat-label">æ­£ç¡®æ¬¡æ•°</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="accuracy">0%</div>
                <div class="stat-label">å‡†ç¡®ç‡</div>
            </div>
        </div>
    </div>

    <script>
        // çŠ¶æ€
        let currentStep = 0;
        let counter = 0; // åˆå§‹å€¼ 00 (å¼ºä¸è·³è½¬) - gem5 é»˜è®¤åˆå§‹åŒ–ä¸º 0
        let totalPredictions = 0;
        let correctPredictions = 0;
        let autoPlay = false;
        let autoTimer = null;

        // å¾ªç¯æ•°æ®: [iå€¼, å®é™…æ˜¯å¦è·³è½¬]
        const loopData = [
            [0, true],   // i=0, taken
            [1, true],   // i=1, taken
            [2, true],   // i=2, taken
            [3, true],   // i=3, taken
            [4, false],  // i=4, not taken (é€€å‡º)
        ];

        // åˆå§‹åŒ–è®¡æ•°å™¨è¡¨
        function initCounterTable() {
            const table = document.getElementById('counter-table');
            table.innerHTML = '';

            // æ˜¾ç¤º index 0-4 é™„è¿‘çš„è®¡æ•°å™¨ (jl æŒ‡ä»¤æ˜ å°„åˆ° index 2)
            for (let i = 0; i <= 4; i++) {
                const cell = document.createElement('div');
                cell.className = 'counter-cell';
                cell.id = `cell-${i}`;
                cell.innerHTML = `
                    <span class="idx">[${i}]</span>
                    <span class="val">${i === 2 ? counter : 0}</span>
                `;
                table.appendChild(cell);
            }
        }

        // æ›´æ–°çŠ¶æ€æœºé«˜äº®
        function updateStateMachine(value) {
            for (let i = 0; i <= 3; i++) {
                document.getElementById(`state-${i}`).classList.remove('active');
            }
            document.getElementById(`state-${value}`).classList.add('active');
        }

        // æ›´æ–°è®¡æ•°å™¨è¡¨
        function updateCounterTable() {
            const cell = document.getElementById('cell-2');
            cell.querySelector('.val').textContent = counter;
        }

        // é«˜äº®ä»£ç è¡Œ
        function highlightCode(lineIndex) {
            for (let i = 0; i <= 7; i++) {
                const el = document.getElementById(`code-${i}`);
                if (el) el.classList.remove('highlight');
            }
            if (lineIndex >= 0) {
                const el = document.getElementById(`code-${lineIndex}`);
                if (el) el.classList.add('highlight');
            }
        }

        // è·å–é¢„æµ‹ç»“æœ
        function getPrediction(counterVal) {
            return counterVal >= 2; // MSB = 1 åˆ™é¢„æµ‹è·³è½¬
        }

        // ä¸‹ä¸€æ­¥
        function nextStep() {
            if (currentStep >= loopData.length * 2) {
                // å®Œæˆ
                document.getElementById('explanation').innerHTML = `
                    <p>ğŸ‰ <span class="highlight-text">æ¼”ç¤ºå®Œæˆï¼</span></p>
                    <p>LocalBP åœ¨è¿™ä¸ªå¾ªç¯ä¸­çš„è¡¨ç°ï¼š5 æ¬¡é¢„æµ‹ï¼Œ2 æ¬¡æ­£ç¡®ï¼Œ3 æ¬¡é”™è¯¯ï¼Œå‡†ç¡®ç‡ 40%ã€‚</p>
                    <p>å‰ 2 æ¬¡é¢„æµ‹é”™è¯¯ï¼šè®¡æ•°å™¨ä» 0 å¼€å§‹ï¼Œéœ€è¦"çƒ­èº«"æ‰èƒ½å­¦ä¼šè¿™æ˜¯ä¸ªå¾ªç¯ã€‚</p>
                    <p>æœ€å 1 æ¬¡é¢„æµ‹é”™è¯¯ï¼šè®¡æ•°å™¨å·²é¥±å’Œåˆ° 3ï¼Œé¢„æµ‹"è·³è½¬"ï¼Œä½†å®é™…é€€å‡ºå¾ªç¯äº†ã€‚</p>
                    <p>è¿™æ˜¯ LocalBP çš„å…¸å‹è¡Œä¸º â€”â€” å¾ªç¯å¼€å§‹å’Œç»“æŸæ—¶å®¹æ˜“é¢„æµ‹é”™è¯¯ã€‚</p>
                `;
                document.getElementById('nextBtn').disabled = true;
                stopAuto();
                return;
            }

            const dataIndex = Math.floor(currentStep / 2);
            const [iVal, actualTaken] = loopData[dataIndex];
            const isLookup = currentStep % 2 === 0;

            if (isLookup) {
                // æŸ¥è¡¨é˜¶æ®µ - é«˜äº® jl æŒ‡ä»¤ (ç¬¬6è¡Œ)
                highlightCode(6);
                document.getElementById('cell-2').classList.add('active');
                document.getElementById('i-value').textContent = iVal;

                const prediction = getPrediction(counter);
                document.getElementById('counter-display').textContent = `${counter} (${counter.toString(2).padStart(2, '0')})`;
                document.getElementById('prediction-display').textContent = prediction ? 'TAKEN' : 'NOT TAKEN';
                document.getElementById('prediction-display').className = `value ${prediction ? 'taken' : 'not-taken'}`;
                document.getElementById('actual-display').textContent = '-';
                document.getElementById('correct-display').textContent = '-';

                updateStateMachine(counter);

                document.getElementById('explanation').innerHTML = `
                    <p>ğŸ” <span class="highlight-text">ç¬¬ ${dataIndex + 1} æ¬¡å¾ªç¯ (i=${iVal})</span> - æŸ¥è¡¨é¢„æµ‹</p>
                    <p>1. PC = 0x40100B (jl æŒ‡ä»¤)ï¼Œè®¡ç®—ç´¢å¼• = 2</p>
                    <p>2. æŸ¥è¡¨ localCtrs[2] = ${counter} (${counter.toString(2).padStart(2, '0')})</p>
                    <p>3. MSB = ${counter >= 2 ? 1 : 0}ï¼Œé¢„æµ‹ï¼š<span class="highlight-text">${prediction ? 'è·³è½¬ (Taken)' : 'ä¸è·³è½¬ (Not Taken)'}</span></p>
                `;
            } else {
                // æ›´æ–°é˜¶æ®µ
                const prediction = getPrediction(counter);
                const isCorrect = prediction === actualTaken;
                const oldCounter = counter;

                // æ›´æ–°è®¡æ•°å™¨
                if (actualTaken) {
                    counter = Math.min(3, counter + 1);
                } else {
                    counter = Math.max(0, counter - 1);
                }

                document.getElementById('actual-display').textContent = actualTaken ? 'TAKEN' : 'NOT TAKEN';
                document.getElementById('actual-display').className = `value ${actualTaken ? 'taken' : 'not-taken'}`;
                document.getElementById('correct-display').textContent = isCorrect ? 'âœ“ æ­£ç¡®' : 'âœ— é”™è¯¯';
                document.getElementById('correct-display').className = `value ${isCorrect ? 'correct' : 'wrong'}`;

                updateCounterTable();
                updateStateMachine(counter);

                // æ›´æ–°ç»Ÿè®¡
                totalPredictions++;
                if (isCorrect) correctPredictions++;
                document.getElementById('total-count').textContent = totalPredictions;
                document.getElementById('correct-count').textContent = correctPredictions;
                document.getElementById('accuracy').textContent = `${Math.round(correctPredictions / totalPredictions * 100)}%`;

                // æ·»åŠ å†å²è®°å½•
                const historyBody = document.getElementById('history-body');
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${dataIndex + 1}</td>
                    <td>${iVal}</td>
                    <td>${oldCounter} (${oldCounter.toString(2).padStart(2, '0')})</td>
                    <td class="${prediction ? 'correct' : 'wrong'}">${prediction ? 'Taken' : 'Not Taken'}</td>
                    <td class="${actualTaken ? 'correct' : 'wrong'}">${actualTaken ? 'Taken' : 'Not Taken'}</td>
                    <td class="${isCorrect ? 'correct' : 'wrong'}">${isCorrect ? 'âœ“' : 'âœ—'}</td>
                    <td>${counter} (${counter.toString(2).padStart(2, '0')})</td>
                `;
                historyBody.appendChild(row);

                document.getElementById('explanation').innerHTML = `
                    <p>ğŸ“ <span class="highlight-text">ç¬¬ ${dataIndex + 1} æ¬¡å¾ªç¯ (i=${iVal})</span> - æ›´æ–°è®¡æ•°å™¨</p>
                    <p>å®é™…ç»“æœï¼š${actualTaken ? 'è·³è½¬ (Taken)' : 'ä¸è·³è½¬ (Not Taken)'}</p>
                    <p>é¢„æµ‹${isCorrect ? 'æ­£ç¡® âœ“' : 'é”™è¯¯ âœ—'}ï¼è®¡æ•°å™¨ ${oldCounter} â†’ ${counter}</p>
                    ${!isCorrect ? '<p style="color: #f85149;">âš ï¸ è¿™æ˜¯å¾ªç¯é€€å‡ºæ—¶çš„å…¸å‹é”™è¯¯ï¼</p>' : ''}
                `;

                document.getElementById('cell-2').classList.remove('active');
            }

            currentStep++;
        }

        // è‡ªåŠ¨æ’­æ”¾
        function toggleAuto() {
            if (autoPlay) {
                stopAuto();
            } else {
                autoPlay = true;
                document.getElementById('autoBtn').textContent = 'â¸ æš‚åœ';
                autoTimer = setInterval(() => {
                    if (currentStep >= loopData.length * 2) {
                        stopAuto();
                    } else {
                        nextStep();
                    }
                }, 1500);
            }
        }

        function stopAuto() {
            autoPlay = false;
            document.getElementById('autoBtn').textContent = 'â© è‡ªåŠ¨æ’­æ”¾';
            if (autoTimer) {
                clearInterval(autoTimer);
                autoTimer = null;
            }
        }

        // é‡ç½®
        function reset() {
            stopAuto();
            currentStep = 0;
            counter = 0;  // åˆå§‹å€¼ 00 (å¼ºä¸è·³è½¬)
            totalPredictions = 0;
            correctPredictions = 0;

            initCounterTable();
            updateStateMachine(0);
            highlightCode(-1);

            document.getElementById('i-value').textContent = '-';
            document.getElementById('counter-display').textContent = '-';
            document.getElementById('prediction-display').textContent = '-';
            document.getElementById('prediction-display').className = 'value';
            document.getElementById('actual-display').textContent = '-';
            document.getElementById('actual-display').className = 'value';
            document.getElementById('correct-display').textContent = '-';
            document.getElementById('correct-display').className = 'value';

            document.getElementById('history-body').innerHTML = '';
            document.getElementById('total-count').textContent = '0';
            document.getElementById('correct-count').textContent = '0';
            document.getElementById('accuracy').textContent = '0%';

            document.getElementById('nextBtn').disabled = false;

            document.getElementById('explanation').innerHTML = `
                <p>ğŸ‘‹ æ¬¢è¿ï¼è¿™ä¸ªåŠ¨ç”»æ¼”ç¤º LocalBP å¦‚ä½•é¢„æµ‹ä¸€ä¸ªç®€å•å¾ªç¯çš„åˆ†æ”¯ã€‚</p>
                <p>å¾ªç¯æ‰§è¡Œ 4 æ¬¡ (i=0,1,2,3)ï¼Œå‰ 4 æ¬¡åˆ†æ”¯è·³è½¬ (Taken)ï¼Œæœ€å 1 æ¬¡ä¸è·³è½¬ (Not Taken) é€€å‡ºå¾ªç¯ã€‚</p>
                <p>è®¡æ•°å™¨åˆå§‹å€¼ä¸º <span class="highlight-text">0 (00)</span>ï¼Œå³"å¼ºä¸è·³è½¬"çŠ¶æ€ã€‚</p>
                <p>ç‚¹å‡» <span class="highlight-text">"ä¸‹ä¸€æ­¥"</span> å¼€å§‹æ¼”ç¤ºï¼</p>
            `;
        }

        // åˆå§‹åŒ–
        initCounterTable();
        updateStateMachine(0);
    </script>
</body>

</html>